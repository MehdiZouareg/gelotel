{% extends 'AppBundle::base.html.twig' %}

{% block body %}
    <h1>Reservation creation</h1>
    {{ form_start(form, {'attr': {'id': 'form-resa' }} ) }}
        {{ form_row(form.datearr) }}
        {{ form_row(form.datedep) }}
        {{ form_row(form.hotel) }}
        {{ form_row(form.chambre, {'attr': {'class': 'chambre-form', 'role': 'form', 'id': 'chambre'}} ) }}
    {{ form_end(form) }}

    <input id="search-button" type="submit" value="Trouver les chambres disponibles"/>

    <ul>
        <li>
            <a href="{{ path('reservation_index') }}">Back to the list</a>
        </li>
    </ul>

{% endblock %}

{% block javascripts %}
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ asset('bundles/app/js/jquery-3.0.0.js') }}"></script>
    <script src="{{ asset('bundles/app/js/reservation/script_ajout_chambres.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
    <script>
        var $prevajax = null;
        $('#search-button').on('click', function (prototype) {

            var rh = document.getElementById("reservation_hotel");
            var dDepyear = document.getElementById("reservation_datedep_year");
            var dDepmonth = document.getElementById("reservation_datedep_month");
            var dDepday = document.getElementById("reservation_datedep_day");
            var dArryear = document.getElementById("reservation_datearr_year");
            var dArrmonth = document.getElementById("reservation_datearr_month");
            var dArrday = document.getElementById("reservation_datearr_day");

            var strRh = rh.options[rh.selectedIndex].value;
            var strDepyear = dDepyear.options[dDepyear.selectedIndex].value;
            var strDepmonth = dDepmonth.options[dDepmonth.selectedIndex].value;
            var strDepday = dDepday.options[dDepday.selectedIndex].value;
            var strArryear = dArryear.options[dArryear.selectedIndex].value;
            var strArrmonth = dArrmonth.options[dArrmonth.selectedIndex].value;
            var strArrday = dArrday.options[dArrday.selectedIndex].value;

            var dateDep = strDepyear + "-" + strDepmonth + "-" + strDepday;
            var dateArr = strArryear + "-" + strArrmonth + "-" + strArrday;
            console.log(dateDep + " " + dateArr);

            if ($prevajax)
            {
                $prevajax = null;
            }
            $prevajax = $.ajax
            ({

                url: Routing.generate('recherche_chambre'),
                method: "POST",
                data: {hotel : strRh, dateDep : dateDep, dateArr : dateArr},
                success: function (data) {
                    $('#results').html('');
                    $prevajax = null;
                    console.log(data);
                    //Le JSON est transform√© en objet ici
                    var objData = jQuery.parseJSON(data);
                    console.log(objData);
                    for (i = 0; i <= objData.length - 1; i++) {
                        console.log(objData[i].id);
                    }

                },
                error: function (data)
                {
                    console.log("Erreur Serveur !");
                    console.log(data);
                }

            });
        });
    </script>
{% endblock %}




